<html>
  <head>
    <link rel="stylesheet" href="../../css/spectre.min.css">
  </head>
  <body>

    <h4>List of products</h4>
    <table class="table">
      <thead>
        <tr>
          <th>name</th>
          <th>actions</th>
        </tr>
      </thead>
      <tbody id="products">

      </tbody>
    </table>
    <br><br>
    <h4>Add a new product</h4>
    <form id="add_product_form">
      <div class="columns">
        <textarea id="area" class="form-input"></textarea>
        <div class="column col-4 col-xs-12">
          <button id="add_product_button" class="btn btn-primary btn-sm">Add</button>
        </div>
      </div>
    </form>
    <br><br>
    <button id="reset" class="btn btn-error">Reset</button> <button id="upload" class="btn btn-primary">Upload</button>

    <script src="../../core/lib/customize.js"></script>

    <script>

      var products = []
     try{
        var stored = localStorage.getItem('grocery-product-list-aug')
        if(stored){
          products = JSON.parse(stored);
          console.log(products);
        }
       
      }catch(e){}
      
      var tstring = "";
      for(e in products) {
        tstring += products[e]["name"]+"\n";
      }
      document.getElementById("area").value = tstring;


      var $form = document.getElementById('add_product_form')
      var $button = document.getElementById('add_product_button')
      var $list = document.getElementById('products')
      var $reset = document.getElementById('reset')
      var $area = document.getElementById("area");             
      var $lines = [];
      function getLines() {
        $lines = area.value.replace(/\r\n/g,"\n").split("\n");
        for (var i in $lines) {
          $lines[i] = $lines[i].trim();
        }
      }
      getLines();


      $reset.addEventListener('click', reset)

      $form.addEventListener('submit', event => {
        event.preventDefault()
        getLines();
        alert($area.value);
        for(var i in $lines) {
          var name = $lines[i];
          alert(name);
          products.push({
            name,
            ok: false
          })
        }


        save()
      })

      function save(){
        localStorage.removeItem('grocery-product-list-aug')
        localStorage.setItem('grocery-product-list-aug',JSON.stringify(products));
      }

    //$button.addEventListener('click')


      document.getElementById("upload").addEventListener("click", function() {
        sendCustomizedApp({
          storage:[
            { name:"grocery_list_aug.json", content: JSON.stringify({products: products}) }
          ]
        });
      });
    </script>
  </body>
</html>
